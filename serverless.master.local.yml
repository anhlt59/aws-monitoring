service: monitoring-master

provider:
  name: aws
  stage: "local"
  region: ${opt:region, self:custom.configs.Region}
  stackName: ${self:service}-${self:provider.stage}

  # default tags for all resources
  stackTags:
    Owner: ${self:service}
    Environment: ${self:provider.stage}
  tags: ${self:provider.stackTags}

  # config lambda functions
  runtime: python3.12

  # Default environment for lambda functions
  environment:
    STAGE: ${self:provider.stage}
    POWERTOOLS_LOG_LEVEL: DEBUG
    MONITORING_WEBHOOK_URL: ${self:custom.configs.MonitoringConfigs.MonitoringWebhookUrl}
    DYNAMODB_TABLE: monitoring-master-local

plugins:
  - serverless-plugin-utils
  - serverless-python-requirements
  - serverless-offline
  - serverless-localstack

useDotenv: true

custom:
  # load the configuration corresponding to a specific $stage
  configs:
    ${file(infra/master/configs/${self:provider.stage}.yml)}
    # plugins
  localstack:
    stages: [local]
    debug: false
    lambda:
      mountCode: true
    autostart: true
  pythonRequirements: ${file(infra/master/plugins/python_requirements.yml):pythonRequirements}

package:
  individually: true
  excludeDevDependencies: true
  patterns:
    - "!./**"

functions: ${file(serverless.master.yml):functions}

resources: ${file(serverless.master.yml):resources}
