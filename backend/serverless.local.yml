service: monitoring

provider:
  name: aws
  stage: "local"
  region: ${opt:region, self:custom.configs.Region}
  stackName: ${self:service}-${self:provider.stage}

  # default tags for all resources
  stackTags:
    owner: ${self:service}
    environment: ${self:provider.stage}
  tags: ${self:provider.stackTags}

  # config lambda functions
  runtime: python3.13

  # Default environment for lambda functions
  environment:
    STAGE: ${self:provider.stage}
    POWERTOOLS_LOG_LEVEL: DEBUG
    MONITORING_WEBHOOK_URL: ${self:custom.configs.MonitoringConfigs.Webhooks.Monitoring}
    DYNAMODB_TABLE: monitoring-local

plugins:
  - serverless-plugin-utils
  - serverless-offline
  - serverless-localstack

useDotenv: true

custom:
  version: v1.0.1
  # load the configuration corresponding to a specific $stage
  configs: ${file(../infra/configs/${self:provider.stage}.yml)}
  # plugins
  localstack:
    stages: [local]
    debug: false
    lambda:
      mountCode: true
    autostart: true
  pythonRequirements: ${file(../infra/plugins/python_requirements.yml):pythonRequirements}

package:
  individually: false
  excludeDevDependencies: false

functions: ${file(serverless.yml):functions}

resources: ${file(serverless.yml):resources}
