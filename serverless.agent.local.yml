service: monitoring-agent

provider:
  name: aws
  stage: "local"
  region: ${opt:region, self:custom.stackConfigs.Region}
  stackName: ${self:service}-${self:provider.stage}

  # default tags for all resources
  stackTags:
    owner: ${self:service}
    environment: ${self:provider.stage}
  tags: ${self:provider.stackTags}

  # config lambda functions
  runtime: python3.12

  # Default environment for lambda functions
  environment:
    REGION: ${self:provider.region}
    STAGE: ${self:provider.stage}
    POWERTOOLS_LOG_LEVEL: DEBUG

plugins:
  - serverless-plugin-utils
  - serverless-python-requirements
  - serverless-offline
  - serverless-localstack

useDotenv: true

custom:
  # load the configuration corresponding to a specific $stage
  stackConfigs: ${file(infra/agent/configs/${self:provider.stage}.yml)}
  monitoringConfigs:
    ${file(infra/agent/configs/${self:provider.stage}.yml):MonitoringConfigs}
    # plugins
  localstack:
    stages: [local]
    debug: false
    lambda:
      mountCode: true
    autostart: true
  pythonRequirements: ${file(infra/agent/plugins/python_requirements.yml):pythonRequirements}

package:
  individually: true
  excludeDevDependencies: true
  patterns:
    - "!./**"

functions: ${file(serverless.agent.yml):functions}

resources: ${file(serverless.agent.yml):resources}
